# Aether — Reverse Proxy
#
# Single origin: all services behind one domain.
# Dashboard (Next.js) is the default backend.
# /api/* routes go to the orchestrator (except /api/auth/* which is Next.js/better-auth).
#
# Dev:  localhost:3000 (HTTP, auto-HTTPS disabled)
# Prod: {$DOMAIN:localhost} (auto-HTTPS via Let's Encrypt)

{$DOMAIN:localhost:3000} {
	# ── Next.js better-auth ──
	# Must come before the /api/* catch-all so /api/auth/* stays with Next.js
	handle /api/auth/* {
		reverse_proxy dashboard:3000
	}

	# ── Orchestrator API ──
	# All other /api/* paths go to the orchestrator
	handle /api/* {
		reverse_proxy orchestrator:9000
	}

	# ── Dashboard (default) ──
	# Everything else goes to Next.js (pages, static assets, etc.)
	handle {
		reverse_proxy dashboard:3000
	}
}
