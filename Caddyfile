# Aether — Reverse Proxy
#
# Single origin: all services behind one domain.
# Dashboard (Next.js) is the default backend.
# /api/* and /ws are proxied to the orchestrator.
#
# Dev:  localhost:3000 (HTTP, auto-HTTPS disabled)
# Prod: {$DOMAIN:localhost} (auto-HTTPS via Let's Encrypt)

{$DOMAIN:localhost:3000} {
	# ── Orchestrator API ──
	# All /api/* paths EXCEPT /api/auth/* (which is handled by Next.js/better-auth)
	handle /agents/* {
		reverse_proxy orchestrator:9000
	}
	handle /pair/* {
		reverse_proxy orchestrator:9000
	}
	handle /devices* {
		reverse_proxy orchestrator:9000
	}
	handle /services/* {
		reverse_proxy orchestrator:9000
	}
	handle /memory/* {
		reverse_proxy orchestrator:9000
	}
	handle /health {
		reverse_proxy orchestrator:9000
	}
	handle /auth/me {
		reverse_proxy orchestrator:9000
	}

	# ── WebSocket proxy ──
	handle /ws {
		reverse_proxy orchestrator:9000
	}

	# ── Dashboard (default) ──
	# Everything else goes to Next.js (including /api/auth/*)
	handle {
		reverse_proxy dashboard:3000
	}
}
